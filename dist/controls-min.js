!function(t,e){if("function"==typeof define&&define.amd)define(["Box","module"],e);else{e(Box)}}(0,function(t,e){var i,o=t.$,n=void 0===e.config().loadCss||e.config().loadCss;function s(e,i){var n=this;this.cid=t._.uniqueId("view"),this.$el=this.$el||o(e),this.options=this.options||o.extend({},t.UI.Control.defaults,this.$el.data(),i||{}),this.p=this.p||Promise.resolve(),this.p.then(function(){var t;if(!n.options.domLink)return Promise.resolve();(t=n.$el.data(n.options.domLink))&&"function"==typeof t.destroy&&(t.destroy(),n.options[n.options.domLink]&&(n.options[n.options.domLink]=null)),n.$el.data(n.options.domLink,n)}).then(function(){return n.initialize()})}"undefined"==typeof CDN_ROOT&&(CDN_ROOT=""),t.UI=t.UI||{};var r=/^(\S+)\s*(.*)$/;function a(e,i){this.$el=this.$el||o(e),this.options=this.options||o.extend({},t.UI.View.defaults,this.$el.data(),i||{}),this.$container=this.$el.find(this.options.selectContainer),this.$messages=this.$el.find(this.options.messagesContainer),this.childrens=[],t.UI.Control.call(this,e,this.options)}function l(e,i){this.$el=this.$el||o(e),this.options=this.options||o.extend({},t.UI.Select.defaults,this.$el.data(),i||{}),this.options.className=this.options.className||this.$el.data("field-target"),this.options.field=this.options.field||this.$el.data("bm-field").split("$")[1],this.options.parentClass=this.options.parentClass||this.$el.data("bm-field").split("$")[0],this.options.searchFor=this.options.searchFor||o(e).data("search-for")||t.UI.Select.defaults.mapSearch[this.options.className]||"name",this.options.display=this.options.display||o(e).data("display"),this.options.relation=this.options.relation||"Relation"===this.$el.data("field-type"),this.options.preload=this.options.preload||!!this.$el.data("preload"),this.options.withData=this.options.withData||!!this.$el.data("with-data"),t.UI.Control.call(this,e,o.extend({},t.UI.Select.defaults,i||{}))}function c(e,i){this.$el=this.$el||o(e),this.options=this.options||o.extend({},t.UI.DataTable.defaults,this.$el.data(),i||{}),this.options.className=this.options.className||this.$el.data("class-name"),this.queryOptions=this.options.query||{},this.where=this.options.where||{},this._include=this.options.include||this.$el.data("query-include"),this._storageKey=this._storageKey||this.$el.attr("id")||"DataSet:"+this.options.className+"#"+(this.$el.parents(".jarviswidget").eq(0).attr("id")||"")+":"+(t.User.current()?t.User.current().id:"*"),t.UI.Control.call(this,e,o.extend({},t.UI.DataTable.defaults,i||{}))}function d(e,i){this.$el=o(e),this.options=o.extend({},t.UI.PivotTable.defaults,i||{}),t.UI.Control.call(this,e,this.options)}function u(e,i){this.$el=this.$el||o(e),this.options=this.options||o.extend({},t.UI.Editor.defaults,o(this.$el).data(),i||{}),this.readOnly=!0,this.selects=this.selects||{},this.files=this.files||{},t.UI.Control.call(this,e)}function p(e,i){this.$el=this.$el||o(e),this.options=this.options||o.extend({},t.UI.DataSet.defaults,this.$el.data(),i||{}),this.options.className=this.options.className||this.$el.data("class-name"),void 0===this.options.createNew&&(this.options.createNew=!!this.$el.data("acl-create")),t.UI.Control.call(this,e)}o.extend(s.prototype,t.Events,{$:function(t){return this.$el.find(t)},destroy:function(){return this.trigger("destroy"),this._removeElement(),this.stopListening(),this.p},_removeElement:function(){this.$el.remove()},initialize:function(){var e=this,i=Array.prototype.slice.call(arguments);return this.options.events&&this.delegateEvents(this.options.events),this.options.controller&&(this.p=this.p.then(function(){return t.Utils.require(e.options.controller.src||e.options.controller).then(function(t){"function"==typeof t?e.controller=new t(e):t&&"function"==typeof t.getController?e.controller=t.getController(e):t&&"function"==typeof t.init&&t.init.call(e,e.$el)})})),this.p.then(function(){return e.trigger("initialized"),e.render.apply(e,i)})},render:function(){return this.trigger("rendered"),this.p},show:function(){this.trigger("show"),this.$el.show()},hide:function(){this.trigger("hide"),this.$el.hide()},delegateEvents:function(e){if(!(e=e||(e=t._.result(this,"events"))))return this;for(var i in this.undelegateEvents(),e){var o=e[i];if(t._.isFunction(o)||(o=this[o]),o){var n=i.match(r);this.delegate(n[1],n[2],t._.bind(o,this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this.on(t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this.off(),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this.off(t,i),this},_setAttributes:function(t){this.$el.attr(t)}}),s.prototype.constructor=s,t.UI.Control=s,t.UI.Control.defaults={domLink:"box.control",constructorClass:"box.constructor"},a.prototype=Object.create(s.prototype),a.prototype.constructor=a,a.prototype.initialize=function(){var e=this;return t.UI.Control.prototype.initialize.call(this).then(function(){return e.loadChildrens()})},a.prototype.showMessage=function(t){return this.$messages.html(t)},a.prototype.cleanChildrens=function(){var t,e=this,i=[],n=o.grep(this.childrens||[],function(t){return"function"==typeof t.destroy});for(t=0;t<n.length;t++)i.push(n[t].destroy());return o.when.apply(o,i).then(function(){for(var t,i=(e.childrens||[]).length;i--;)"function"==typeof(t=e.childrens.pop()).destroy&&t.destroy(),delete t;return e.childrens=[],Promise.resolve()})},a.prototype.loadChildrens=function(e){var i=[],n=this;return this.p=this.p.then(function(){return n.$container.find(n.options.childControls).each(function(s,r){var a,l,c=o(r).data("controller");if("function"==typeof n.options.childConstructor)return l=new n.options.childConstructor(r,e),n.childrens.push(l),void(l.p&&i.push(l.p));c&&(a=t.Utils.require(c).then(function(t){if(t&&"function"==typeof t.init)return t.init(r,n,e)}).then(function(){var t=o(r).data(n.options.domLink);t&&n.childrens.push(t)}).catch(function(e){t.Trace.captureException(e)}),i.push(a))}),Promise.all(i)}),this.p},a.prototype.load=function(e,i){var n=this;return i&&(e=e+"?"+t.Utils.querystring.stringify(i)),o.ajax({type:"GET",url:e,dataType:"html",beforeSend:function(e){n.showMessage(t.UI.View.defaults.loadingHtml),n.$container.css({opacity:"0.0"})}}).then(function(t){return n.cleanChildrens().then(function(){return n.$messages.hide(),n.$container.html(t).delay(50).animate({opacity:"1.0"},300),n.loadChildrens(i)})},function(i,o,s){n.showMessage(t.UI.View.defaults.errorHtml.format({url:e,status:i.status,err:s})),n.$container.animate({opacity:"1.0"},300)})},a.prototype.destroy=function(){var e=this;return this.cleanChildrens().then(function(){return t.UI.Control.prototype.destroy.call(e)})},t.UI.View=a,t.UI.View.defaults=o.extend({},t.UI.Control.defaults,{loadingHtml:'<h1 class="ajax-loading-animation"><i class="fa fa-cog fa-spin"></i> Loading...</h1>',errorHtml:'<h4 class="ajax-loading-error"><i class="fa fa-warning txt-color-orangeDark"></i> Error requesting <span class="txt-color-red">{url}</span>: {status} <span style="text-transform: capitalize;"> {err}</span></h4>',selectContainer:"box-content-container",messagesContainer:"box-messages-container",childControls:"[data-controller]"}),l.prototype=Object.create(s.prototype),l.prototype.constructor=l,l.prototype.initialize=function(){var e=this;return t.UI.Control.prototype.initialize.call(this).then(function(){return new Promise(function(i,n){var s=Promise.resolve(),r=e.options;return e.query?i():(this.__initial=[],e.query=r.query||new t.Query(r.className),r.display&&-1!==r.display.indexOf(".")&&r.display.split(";").forEach(function(t){var i=t.split(".");i.length>1&&e.query.include(i[0])}),r.order&&(e.query._order=r.order.split(",")),o.fn.select2||(s=t.Utils.require(["select2"])),s.then(function(){var t={};return void 0!==r.useMasterKey&&(t.useMasterKey=r.useMasterKey),r.preload?e.query.find(t).then(function(t){var i=o.map(t,function(t){return'<option value="'+encodeURI(t.id)+'">'+(e.options.display||e.options.searchFor).split(",").map(function(e){return t.get(e)||""}).join(", ")+"</option>"}).join("");e.$el.html(i),e.$el.select2(o.extend({width:r.relation?"100%":r.width,allowClear:!e.options.bmRequired,placeholder:e.options.placeholder||"Select "+e.options.className},r)),e.$el.on("select2:select",function(){e.$el.data("select2").trigger("selection:update",{data:o(this).val()?o(this).select2("data"):[]})}),e.options.bmRequired||e.$el.on("select2:unselect",function(t){e.$el.data("select2").trigger("selection:update",{data:[]})})}):r.withData?(e.$el.select2(o.extend({width:r.relation?"100%":r.width,allowClear:!e.options.bmRequired,placeholder:e.options.placeholder||"Select "+e.options.className},r)),e.$el.on("select2:select",function(){e.$el.data("select2").trigger("selection:update",{data:o(this).val()?o(this).select2("data"):[]})}),void(e.options.bmRequired||e.$el.on("select2:unselect",function(t){e.$el.data("select2").trigger("selection:update",{data:[]})}))):(e.$el.select2(o.extend({width:r.relation?"100%":r.width,minimumInputLength:e.options.minimumInputLength||3,allowClear:!e.options.bmRequired,placeholder:e.options.placeholder||"Select "+e.options.className,ajax:{delay:250,transport:function(i,o,n){e.options.searchFor.split(",").forEach(function(t){e.query.matches(t,new RegExp(i.data.q.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"gi"))}),e.query.find(t).then(function(t){o(t)},function(t){n(t)})},processResults:function(t,i){var n=(e.options.display||e.options.searchFor).split(",");return{results:o.map(t,function(t){return{id:t.id,text:n.map(function(e){var i=e.split("."),o=e,n=t;return i.length>1&&(n=t.get(i[0]),o=i[1]),n.get(o)||""}).join(", ")}})}}}},r)),void(e.options.bmRequired||e.$el.on("select2:unselect",function(t){e.$el.empty()})))}).then(i,n))})})},l.prototype.val=function(e,i){var n=this;return this.options.preload||this.options.withData?n.$el.val(e).trigger("change"):this.p=this.p.then(function(){var s,r=i||new t.Query(n.options.className);return n.$el.empty().trigger("change"),e?(n.options.relation&&!i?r=e.parent.relation(n.options.field).query():"string"==typeof e&&r.equalTo("objectId",e),n.options.useMasterKey&&(s={useMasterKey:!0}),r.find(s).then(function(t){n.__initial=t,n.$el.html(o.map(t,function(t){return n.options.relation,'<option value="{id}" selected="selected">{text}</option>'.format({id:t.id,text:t.get(n.options.searchFor)})}).join("")).trigger("change")})):Promise.resolve()}),this.p},l.prototype.syncRelation=function(e){var i=this;return this.p=this.p.then(function(){var n=i.$el.val();if(!i.options.relation||!e)return Promise.resolve();o.each(i.__initial,function(t,o){-1===n.indexOf(o.id)&&e.relation(i.options.field).remove(o)}),o.each(n,function(n,s){o.grep(i.__initial,function(t){return t.id===s}).length||e.relation(i.options.field).add(t.Object.fromJSON({className:i.options.className,objectId:s}))})}),this.p},l.prototype.destroy=function(){return this.$el.select2("destroy"),t.UI.Control.prototype.destroy.call(this)},t.UI.Select=l,t.UI.Select.defaults=o.extend({},t.UI.Control.defaults,{width:"250px",mapSearch:{_User:"username",Files:"fileName"}}),c.prototype=Object.create(s.prototype),c.prototype.constructor=c,c.prototype._exportData=function(e,i,n,s){i.settings()[0].aoColumns;var r=i.columns(":visible")[0].map(function(t){return i.settings()[0].aoColumns[t].field});t.CoreManager.getRESTController().request("POST","tasks/create",{query:this.__qcache,className:this.options.className,items:r,title:"Export "+this.options.className+" items",content:"Export task will be created, when data is ready you will be notified",type:"export"}).then(function(e){return t.Utils.require("notification").then(function(){o.notify({message:"Export data task created",type:"info",icon:"fa fa-download"},{timeout:5e3})})},function(e){t.Utils.require("notification").then(function(){t.Trace.captureException(e)})})},c.prototype.initialize=function(){var e=this,n={responsive:!0,deferRender:!0,serverSide:!0,processing:!0,ajax:function(i,n,s){function r(s){if(s.limit(i.length),i.start&&s.skip(i.start),i.order&&i.order.length){var r=i.columns[i.order[0].column].data;"asc"===i.order[0].dir?s.ascending(r):s.descending(r)}e._include&&s.include(e._include),s.find(e.queryOptions).then(function(t){var s={draw:i.draw,recordsTotal:e.___totalCount||0,recordsFiltered:e.___count,data:o.map(t,function(t){var e={DT_RowData:t};return o.each(i.columns,function(i,o){var n,s;""!==o.data&&(n=o.data.split("."),s=void 0!==t.get(n[0])?t.get(n[0]):t[n[0]],n.length>1?(e[n[0]]=e[n[0]]||{},e[n[0]][n[1]]=s?s.get(n[1]):null):e[n[0]]=s)}),e})};e._records=t,e.trigger("changed",t),n(s)}).catch(function(o){t.Trace.captureException(o),e.trigger("changed"),n({draw:i.draw,data:[],recordsTotal:0,recordsFiltered:0})})}if(e.where&&Object.keys(e.where).length&&e.where.parentClass&&e.where.fieldId&&e.where.objectId){var a=t.Object.fromJSON({className:e.where.parentClass,objectId:e.where.objectId});rqp=a.relation(e.where.fieldId).query()}("function"==typeof e.options.getSearchQuery?e.options.getSearchQuery:e.getSearchQuery).call(e,i.search?i.search.value:void 0).then(function(t){var o=JSON.stringify(t.toJSON());return e.__qcache===o?r(t):t.count(e.queryOptions).then(function(n){return i.search&&i.search.value&&""!==i.search.value||(e.___totalCount=n),e.___count=n,e.__qcache=o,r(t)},function(t){return e.onError(t),n({draw:i.draw,data:[],recordsTotal:0,recordsFiltered:0,error:t.message||t})})})}};if(o.each(this.options,function(t,e){"dt"===t.substring(0,2)&&(t=t.substring(2),n[t]=e)}),this._requires=["dataTablesResponsiveBoostrap"],n.columns&&n.columns.length||(n.columns=n.columns||this._getColumns()),!n.order)for(var s=0;s<n.columns.length&&!n.order;s++)n.columns[s].sortable&&(n.order=[[s,"asc"]]);if(o.each(n.columns||[],function(t,e){e.defaultContent=e.defaultContent||""}),n.drawCallback=n.drawCallback||this._drawCallback.bind(this),n.searchDelay=n.searchDelay||700,this.dtOptions=n,this.$el.on("init.dt",function(t,e){var i=new o.fn.dataTable.Api(e).table();o(i.container()).find(".dataTables_filter input").unbind().bind("input",function(t){(this.value.length>=3||13==t.keyCode)&&i.search(this.value).draw(),""==this.value&&i.search("").draw()})}),!1!==n.stateSave&&(n.stateSave=!0,n.stateLoadCallback=n.stateLoadCallback||function(i,o){var n=t.CoreManager.getStorageController().getItem(e._storageKey);o(n?JSON.parse(n):n)},n.stateSaveCallback=n.stateSaveCallback||function(i,o){t.CoreManager.getStorageController().setItem(e._storageKey,JSON.stringify(o))}),n.buttons||this.options.defaultButtons){if(this._requires.push("datatables.net-buttons-bs"),this._requires.push("datatables.buttons.colVis"),this._requires.push("datatables.buttons.print"),this.options.defaultButtons&&(n.buttons=n.buttons||[],!1!==this.options.pageLengthButton&&n.buttons.push("pageLength"),!1!==this.options.colvisButton&&n.buttons.push({extend:"colvis",text:'<i class="fa fa-eye"></i>'}),!1!==this.options.printButton&&n.buttons.push({extend:"print",text:'<i class="fa fa-print"></i>',exportOptions:{columns:":visible"}}),!1!==this.options.exportButton&&n.buttons.push({className:"btn btn-default btn-download",text:'<i class="fa fa-download"></i>',action:e._exportData.bind(e)}),this.options.createNew&&"function"==typeof this.options.onCreate)){var r="btn btn-default btn-add";this.options.aclCreate&&"*"!==this.options.aclCreate&&o.each(this.options.aclCreate.split(" "),function(t,e){e&&(r=r+" req-role-"+e)}),n.buttons.push({className:r,text:'<i class="fa fa-plus"></i>',action:e.options.onCreate.bind(e)})}n.dom=n.dom||"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>"}return t.Utils.require(this._requires).then(function(){var t=e._requires.indexOf("moment");-1!==t&&(i=arguments[0][t]),e.dt=e.$el.DataTable(n)})},c.prototype._drawCallback=function(e){var i=this,n=new o.fn.dataTable.Api(e).table(),s=o(n.body());s.find("a.table-cmd-col").each(function(){var e=o(this),s=e.parents("tr"),r=o(s).hasClass("child")?o(s).prev():s,a=n.row(r).data();t.Utils.hasAccess(a.DT_RowData.getACL()).then(function(t){var o=t?i.options.iconButtonEdit:i.options.iconButtonView,n=t?i.options.classButtonEdit:i.options.classButtonView;e.addClass(n).html(o).show()})}),s.find(".btn").on("click",function(e){var s=o(e.currentTarget).data();if("function"==typeof i.options.onAction){var r=o(this).parents("tr"),a=o(r).hasClass("child")?o(r).prev():r,l=n.row(a).data();return i.options.onAction(s,l.DT_RowData,e.currentTarget),void e.preventDefault()}t.Router&&t.Router.lookup("data",s)&&(e.preventDefault(),t.Router.navigate(t.Router.lookup("data",s)))})},c.prototype._getColumn=function(e){var n=this,s={data:"objectId"===e.field?"id":e.field,type:e.type,sortable:void 0===e.sortable?-1!==["Number","Date","String","Boolean"].indexOf(e.type):e.sortable};return this.options.columns&&this.options.columns[e.field]?"function"==typeof this.options.columns[e.field]?this.options.columns[e.field](this,e):this.options.columns[e.field]:(e.targetClass&&(s.targetClass=e.targetClass),"objectId"===e.field?s.render=function(t,e,i,o){return'<a data-object-id="'+t+'" data-field-id="objectId" href="#" class="table-cmd-col '+n.options.classButtons+'" style="display:none"></a>'}:"Date"===e.type?(-1===n._requires.indexOf("moment")&&n._requires.push("moment"),s.render=function(t,o,s,r){return t&&void 0!==i&&i(t).isValid()?i(t).format(e.dateFormat||n.options.dateFormat||"lll"):t||'<i class="fa fa-calendar-o"></i>'}):"Pointer"===e.type?s.render=function(i){return i?i.className?'<a href="#" data-object-id="'+i.id+'" data-field-id="'+e.field+'" data-action="pointer" data-target-class="'+i.className+'" class="btn '+n.options.classButtons+' "><i class="fa fa-search"></i></a>'+("Files"===i.className?' <a href="'+t.serverURL+"/storage/"+t.applicationId+"/"+i.id+'" target="_blank"><i class="fa fa-download"></i></a>':""):i:""}:"Relation"===e.type?s.render=function(t){return t?'<a href="#"  data-object-id="'+(t.parent?t.parent.id:"")+'"  data-field-id="'+e.field+'" data-action="relation" data-target-class="'+(t.targetClassName||e.targetClass||e.className)+'"  class="'+n.options.classButtons+' btn-default"><i class="fa fa-search"></i> view ['+e.field+"] </a>":""}:"String"===e.type?s.render=function(t,e,i){return o("<div>"+(t||"")+"</div>").text().trunc(50,!0)}:"Object"===e.type?s.render=function(t){return t&&Object.keys(t).length?"[object]":""}:"Boolean"===e.type?s.render=function(t){return t?'<i class="fa fa-check-square-o"></i>':'<i class="fa fa-square-o"></i>'}:"File"===e.type?s.render=function(t){return(t=t&&t.toJSON?t.toJSON():t)?'<a href="'+t.url+'" target="_blank"><i class="fa fa-external-link"></i> '+(t.name?t.name.substr(t.name.indexOf("_")+1):"")+"</a>":""}:"Array"===e.type?s.render=function(t){return t?"[array]":"[]"}:"GeoPoint"===e.type?s.render=function(t){return t?"{geopoint}":"{geopoint:new}"}:"Number"===e.type&&(s.render=function(t){return o.isNumeric(t)?"function"==typeof t.format?t.format():t:""}),e.field&&s.sortable&&-1!==e.field.indexOf(".")&&(s.sortable=!1),s)},c.prototype._getColumns=function(){var t=this,e=[];return this.$("thead th").each(function(){var i,n=o(this).data();n.field&&((i=t._getColumn(n))&&e.push(i),t._colsData=t._colsData||{},t._colsData[n.field]=n)}),e},c.prototype.reload=function(){this.__qcache=null,this.dt.ajax.reload()},c.prototype.getSearchQuery=function(e){var n=this,s=new t.Query(this.options.className),r=[],a=[];return this.where&&(s._where=o.extend({},this.where)),o.each(this.dtOptions.columns,function(o,s){var l;if(s.targetClass&&-1!==s.mData.indexOf(".")&&-1===a.indexOf(s.mData.split(".")[0])&&a.push(s.mData.split(".")[0]),e&&s.data&&s.type)switch(s.type.toLowerCase()){case"pointer":case"string":s.data&&(-1===s.data.indexOf(".")?r.push(new t.Query(n.options.className).matches(s.data,new RegExp(e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"gi"))):n._colsData[s.data]&&n._colsData[s.data].targetClass&&(l=s.data.split("."),r.push(new t.Query(n.options.className).matchesQuery(l[0],new t.Query(n._colsData[s.data].targetClass).matches(l[1],new RegExp(e.replace(/[-\[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"gi"))))));break;case"num":case"number":s.data&&!isNaN(parseFloat(e,10))?r.push(new t.Query(n.options.className).equalTo(s.data,parseFloat(e,10))):n._colsData[s.data]&&n._colsData[s.data].targetClass&&(l=s.data.split("."),r.push(new t.Query(n.options.className).matchesQuery(l[0],new t.Query(n._colsData[s.data].targetClass).equalTo(l[1],parseFloat(e,10)))));break;case"date":s.data&&void 0!==i&&i(e).isValid()&&r.push(new t.Query(n.options.className).equalTo(s.data,i(e).toDate()))}}),this.options.columnsOnly&&s.select(o.map(this.dtOptions.columns,function(t){return t.mData})),a.length&&s.include(a),r.length&&s._orQuery(r),Promise.resolve(s)},c.prototype.onError=function(e){t.Trace.captureException(e),"function"==typeof this.options.onError&&this.options.onError.call(this,e)},c.render=function(e,i){t.Utils.render("default/templates/controls/dataset-grid",i).then(function(t){return e.html(t),new c(e.find("table"),i)})},c.prototype.hide=function(){this.trigger("hide"),o(this.dt.table().container()).hide()},c.prototype.show=function(){this.trigger("show"),o(this.dt.table().container()).show()},t.UI.DataTable=c,t.UI.DataTable.defaults=o.extend({},t.UI.Control.defaults,{defaultButtons:!0,classButtons:"btn btn-xs",classButtonEdit:"btn-success",classButtonView:"btn-default",iconButtonEdit:'<i class="fa fa-pencil-square-o"></i>',iconButtonView:'<i class="fa fa-search"></i>'}),d.prototype=Object.create(t.UI.Control.prototype),d.prototype.constructor=d,d.prototype.initialize=function(){var e=this,i=["export_renderers","c3_renderers"];return n&&(i.push("css!"+CDN_ROOT+"/vendor/pivottable/pivot.min.css"),i.push("css!"+CDN_ROOT+"/vendor/c3/c3.css")),t.Utils.require(i).then(function(){return o.extend(o.pivotUtilities.renderers,o.pivotUtilities.c3_renderers,o.pivotUtilities.export_renderers),t.UI.Control.prototype.initialize.call(e)})},d.prototype.render=function(){var e=this;return this.getData().then(function(i){var n="box.pivot."+t.applicationId+"."+(e.options.className||"cls"),s=JSON.parse(t.Storage.getItem(n)||"false")||e.options.pivot||{},r=e.$(e.options.selectContainer);return s.onRefresh=s.onRefresh||e._onRefresh.bind(e),r.length||(r=e.$el),o(r).pivotUI(i,s,!0),t.UI.Control.prototype.render.call(this)})},d.prototype.getData=function(){var e=this,i={};return"function"==typeof this.options.getData?this.options.getData.call(this):this.options.className&&this.options.pipeline?(this.options.useMasterKey&&t.masterKey&&(i={useMasterKey:!0}),t.Cloud.run("data_aggregate",{className:this.options.className,pipeline:this.options.pipeline},i).then(function(t){return"function"==typeof e.options.processData?e.options.processData.call(e,t):e._processData(t)})):Promise.resolve([])},d.prototype._onRefresh=function(e){var i="box.pivot."+t.applicationId+"."+(this.options.className||"cls"),o=JSON.parse(JSON.stringify(e));!1!==this.options.noStatus&&(delete o.aggregators,delete o.renderers,delete o.rendererOptions,delete o.localeStrings,t.Storage.setItem(i,JSON.stringify(o)))},d.prototype._processData=function(e){var i=t._.map(e,function(e){var i={};return t._.each(e,function(o,n){"_id"===n?t._.each(e[n],function(t,e){i[e]=t}):i[n]=o}),i});return Promise.resolve(i)},t.UI.PivotTable=d,t.UI.PivotTable.defaults={},u.prototype=Object.create(s.prototype),u.prototype.constructor=u,u.prototype.initialize=function(){var e,s=this,r=t.UI.Control.prototype.initialize.call(this);if(!this.options.readOnly&&this.options.removeButtonClass?this.$(this.options.removeButtonClass).click(function(t){t.preventDefault(),o(this).hasClass("disabled")||"function"==typeof s.options.onRemove&&s.options.onRemove(s)}):this.$(this.options.removeButtonClass).hide(),this.options.cancelButtonClass&&this.$(this.options.cancelButtonClass).click(function(t){t.preventDefault(),s.wire().then(function(){"function"==typeof s.options.onCancel&&s.options.onCancel(s)})}),!this.options.readOnly&&this.options.createButtonClass?this.$(this.options.createButtonClass).click(function(e){var i=o(e.currentTarget);e.preventDefault(),o(this).hasClass("disabled")||(i.hide(),s.update().then(function(){var t=s.options.useMasterKey?{useMasterKey:!0}:void 0;return s.trigger("saving"),s.model.save({},t)}).then(function(){return s._uploadFiles()}).then(function(){"function"==typeof s.options.onUpdated&&s.options.onUpdated(s),s.trigger("saved"),t.Utils.require("notification").then(function(){o.notify({message:"Updated !",icon:"fa fa-info-circle"},{type:"info"})}),!s.model&&s.model.id&&s._useEditorLock&&t.Socket.hasClient()&&(s._timerSync={className:s.model.className,objectId:s.model.id},s._lockSync()),i.show()}).catch(function(e){i.show(),"function"==typeof s.options.onError&&s.options.onError(e),e.validate||t.Utils.require("notification").then(function(){t.Trace.captureException(e)})}))}):this.$(this.options.createButtonClass).hide(),this.$("[data-is-html]").length){var a=this.$("[data-is-html]");e=["summernote"],n&&e.push("css!"+CDN_ROOT+"/vendor/summernote/summernote"),t.Utils.require(e).then(function(){a.each(function(t,e){vd=o(this).data("bm-field"),vd&&vd.split("$")[0]===s.options.className&&(s.wireSummernote(o(e)),o(e).summernote("code",o(e).val()))})})}return this.$(".input-group-btn .btn").click(function(i){var r=o(i.currentTarget).parents(".input-group"),a=r.find("input"),l=a.data("bm-field");l&&l.split("$")[0]===s.options.className&&(e=["summernote"],i.preventDefault(),n&&e.push("css!"+CDN_ROOT+"/vendor/summernote/summernote"),r.removeClass("input-group").find("button").hide(),t.Utils.require(e).then(function(){s.wireSummernote(a),a.summernote("code",a.val())}))}),this.$("select[data-field-target]").each(function(){var e=o(this).data("bm-field"),i={};s.options.useMasterKey&&(i={useMasterKey:!0}),e&&e.split("$")[0]===s.options.className&&(e=e.split("$")[1],s.options.selects&&s.options.selects[e]&&(i=o.extend(i,s.options.selects[e])),s.selects[e]=new t.UI.Select(this,i))}),this.$('input[data-field-type="Number"]').each(function(e,i){var n=o(this).data("bm-field");n&&n.split("$")[0]===s.options.className&&t.Utils.inputDigitsOnly(o(this))}),this.$('[data-field-type="Date"]').length&&(r=r.then(function(){return t.Utils.require(["moment","bootstrap-datetimepiker"]).then(function(t){i=t,s.$(".form-group .input-group.date").datetimepicker({format:s.options.dateFormat})})})),r=r.then(function(){return s.$(".editor-lock .users-open-close").length&&t.Socket.hasClient()?(s._useEditorLock=!0,s.$(".editor-lock .users-open-close").click(function(t){t.preventDefault(),o(this).parent().toggleClass("open")}),t.Socket.client().then(function(t){t.on("edit",function(t){s._showLocks(t)})})):Promise.resolve()})},u.prototype.wire=function(e,s){var r=this,a=Promise.resolve(),l=this.options.bindFilter||"[data-bm-field]";return e&&e.className&&e.className!==this.options.className?a:(this.model=e,this.__files=[],this.model&&this.model.id?(this.readOnly=this.options.readOnly,this.readOnly?(this.$(".readonly-field").show(),this.$(this.options.removeButtonClass).addClass("disabled"),this.$(this.options.createButtonClass).addClass("disabled")):(this.$(this.options.createButtonClass).html(this.options.updateButtonText),this.$(this.options.removeButtonClass).removeClass("disabled"),this.$(this.options.createButtonClass).removeClass("disabled"))):(this.readOnly=!1,this.$(".readonly-field").hide(),this.$(this.options.removeButtonClass).addClass("disabled"),this.$(this.options.createButtonClass).html(this.options.createButtonText),this.$(this.options.createButtonClass).removeClass("disabled")),this.$(l).each(function(){var s=this;a=a.then(function(){return function e(s,r,a){var l,c=o(this).data(),d=c.bmBind,u=c.bmDefault||"",p=[],h="change",f=s.options.bindFilter||"[data-bm-field]",m=c.bmField,y=Promise.resolve();if(c.bmUpdateOnly||!m||-1===m.indexOf("$"))return Promise.resolve();var g=this.nodeName;m=m.split("$");if(m[0]!==s.options.className)return Promise.resolve();m=m[1];d||("IMG"===g?(d="prop",p.push("src")):"INPUT"===g&&"checkbox"===this.type?(d="prop",p.push("checked")):d="INPUT"===g||"SELECT"===g||"TEXTAREA"===g?"val":"html");l=a||(r?r.get(m):u);l&&l.id&&l.className&&(l=l.id);if("string"==typeof l&&("String"===c.fieldType||0===d.indexOf("summernote;"))){if(l.trim().match(/^<[a-z][\s\S]*>/i)&&($input=o(this),$input.parents(".input-group").removeClass("input-group").find("button").hide(),!o(this).data("summernote"))){var v=["summernote"];return n&&v.push("css!"+CDN_ROOT+"/vendor/summernote/summernote"),t.Utils.require(v).then(function(){s.wireSummernote($input),$input.summernote("code",l),h="summernote.change",$input.off(h).on(h,function(){var t=o(this).val();"function"==typeof s.trigger&&s.trigger("change",m,t),s.$(f+'[data-bm-field="'+o(this).data("bm-field")+'"]').not(this).each(function(){e.call(this,s,r,t)})})})}o(this).data("summernote")&&(d="summernote;code",h="summernote.change")}if("Files"===c.fieldTarget)return s.__files.push(this),y;"Date"===c.fieldType&&(l=l&&void 0!==i&&i(l).isValid()?i(l).format(s.options.dateFormat):l);"Object"===c.fieldType&&(l=l?JSON.stringify(l):l);s.selects&&s.selects[m]?s.selects[m].val(l):("Pointer"===c.fieldType&&(l=r&&"function"==typeof r.get&&r.get(m)&&"function"==typeof r.get(m).get?r.get(m).get(c.searchFor||"name"):l),-1!==d.indexOf(";")&&(d=d.split(";"),p.push(d[1]),d=d[0]),p.push(l),o.fn[d].apply(o(this),p),"INPUT"===g&&"checkbox"===this.type&&o(this).trigger("change"));void 0===c.bmWithNoChange&&o(this).off(h).on(h,function(){var t=o(this).val();"function"==typeof s.trigger&&s.trigger("change",m,t),s.$(f+'[data-bm-field="'+o(this).data("bm-field")+'"]').not(this).each(function(){e.call(this,s,r,t)})});return y}.call(s,r,e)})}),(a=a.then(function(){var i=[],n=Promise.resolve();if(r.$(".file-placeholder .file-list").empty(),r.__files.length){if(e&&(o.each(r.__files,function(t,n){var s=o(n).data().bmField.split("$")[1],r=e.get(s);r&&i.push(r.id)}),i.length)){var s=new t.Query("Files");s.containedIn("objectId",i),n=s.find()}n=n.then(function(t){return Promise.all(o.map(r.__files,function(i){var n,s,a,l=o(i).data(),c=l.bmField.split("$")[1];if(e&&(s=e.get(c)))for(a=0;!n&&a<t.length;a++)t[a].id===s.id&&(n=t[a].toJSON());return r.files[l.bmField]||(r.files[l.bmField]={el:i,role:c}),r.renderImage(n,o(i))}))})}return n})).then(function(){return Promise.all(o.map(r.childrens||[],function(t){return t.wire(e,!0)}))}).then(function(){r.trigger("wired"),r.model&&r.model.id&&r._useEditorLock&&t.Socket.hasClient()&&(r._timerSync={className:r.model.className,objectId:r.model.id},r._lockSync())}))},u.prototype._lockSync=function(){var e=this;if(!this._timerSync)return e._showLocks();Promise.resolve().then(function(){return e.model&&!e.model.isNew()&&o.contains(document,e.$el[0])||(e._timerSync.leave=!0),t.Socket.client().then(function(t){return new Promise(function(i,o){t.emit("edit",e._timerSync,function(t){return e._timerSync.leave&&delete e._timerSync,e._showLocks(t).then(i,o)})})})}).then(function(){setTimeout(e._lockSync.bind(e),e.options.editSyncTimer)},function(){setTimeout(this._lockSync.bind(this),e.options.editSyncTimer)})},u.prototype._showLocks=function(t){var e=[],i="";return t&&this.model&&this.model.id===t.object.objectId?(o.each(t,function(t,o){"object"!==t&&(e.push(o),i+='<li><i class="fa fa-user"></i> {username}</li>'.format(o.editor.user))}),e.length>1?(this.$(".editor-lock").show(),this.$(".editor-lock .lock-list-body ul").html(i)):this.$(".editor-lock").hide(),Promise.resolve()):(this.$(".editor-lock").hide(),Promise.resolve())},u.prototype.addChilds=function(t){this.childrens=this.childrens||[],t.parent=this,this.childrens.push(t)},u.prototype._uploadFiles=function(){var e=this;return Promise.all(o.map(this.files,function(i){return o(i.el).val()?new Promise(function(n,s){var r,a,l=o(i.el).parents(".input-file"),c=(l.find('input[type="file"]')||[])[0];if(c&&c.files&&c.files.length)return r=c.files[0],l.find(".file-edit").hide(),l.find(".fileinput-button").hide(),l.find(".progress").show(),a={role:i.role,className:e.options.className,name:r.name,contentType:r.type||"application/octet-stream"},e.model&&e.model.id&&(a.objectId=e.model.id),t.Cloud.run("createPresignedPost",a).then(function(a){var c,d=new FormData;t.$.each(a.fields,function(t,e){d.append(t,e)}),d.append("file",r),a.file&&(a.file.className=a.file.className||"Files",c=t.Object.fromJSON(a.file)),t.$.ajax({url:a.url,type:"POST",data:d,processData:!1,contentType:!1,success:function(o){return Promise.resolve().then(function(){var o=e.options.useMasterKey?{useMasterKey:!0}:void 0,n=[];if(a.file)return r.size&&c.set("size",r.size),r.lastModifiedDate&&c.set("lastModified",r.lastModifiedDate),c.set("key",a.fields.key),"public-read"===a.fields.ACL&&c.set("url",a.url+"/"+a.fields.key),n.push(c),e.model&&(e.model.set(i.role,c),n.push(e.model)),t.Object.saveAll(n,o).then(function(){return c})}).then(function(i){t.Object.fromJSON(a.file);l.find(".file-edit").show(),l.find(".file-edit").val(""),l.find(".fileinput-button").show(),l.find(".progress").hide(),l.find('input[type="file"]').val(""),e.renderImage(i?i.toJSON():null,l).then(n,s)}).then(n,s)},error:function(){alert("Failed"),l.find(".progress").hide(),l.find(".file-edit").show(),l.find(".fileinput-button").show(),s()},xhr:function(){return myXhr=o.ajaxSettings.xhr(),myXhr.upload?myXhr.upload.addEventListener("progress",function(t){if(t.lengthComputable){var e=Math.floor(t.loaded/t.total*100);l.find(".progress span").html(e<95?e+"%":"sending to cloud.."),l.find(".progress .progress-bar").css({width:e+"%"})}},!1):(l.find(".progress").hide(),console.log("Uploadress is not supported.")),myXhr}})},function(){l.find(".progress").hide(),l.find(".file-edit").show(),l.find(".fileinput-button").show(),s(message)})}):Promise.resolve()})).then(function(){e.options.useMasterKey}).catch(function(i){t.Utils.require("notification").then(function(){t.Trace.captureException(i)}),"function"==typeof e.options.onError&&e.options.onError(i)})},u.prototype.renderImage=function(e,i){var o=this,n=Promise.resolve();if(e){var s=e.url?e.url:t.serverURL+"/storage/"+t.applicationId+"/"+e.objectId,r=i.parents(".file-placeholder").find(".file-list");r.length||(i.parents(".file-placeholder").prepend('<ul class="file-list"></ul>'),r=i.parents(".file-placeholder").find(".file-list")),r.empty(),r.append(o.options.imageFormat.format({display:e.contentType&&0===e.contentType.indexOf("image/")?'<img src="'+s+'">':'<i class="fa fa-file"></i>',name:e.name,id:e.objectId,url:s,size:e.size.toByteSize()})),r.find("a.text-danger:last").click(function(n){var s=i.data();n.preventDefault(),t.Utils.require("bootstrap-dialog").then(function(n){n.confirm({title:"Aten»õie",type:n.TYPE_WARNING,message:"<i class='fa fa-trash-o text-danger'></i> Remove <i>"+e.name+"</i> ?",closable:!0,btnCancelLabel:'<i class="fa fa-ban"></i> Cancel !',btnOKLabel:'<i class="fa fa-trash-o"></i> Delete!',btnOKClass:"btn-danger",callback:function(e){if(e){var n,r=s.bmField.split("$")[1];return o.options.useMasterKey&&{useMasterKey:!0},n=o.model.get(r),o.model.set(r,null),n&&n.set("purged",!0),t.Object.saveAll([n,o.model]).then(function(){o.renderImage(null,i)})}}})})})}else i.parents(".file-placeholder").find(".file-list").remove();return n},u.prototype.validate=function(){var e,i=this,n=(this.options.bindFilter||"[data-bm-field]")+"[data-bm-required]",s=Promise.resolve();return this.$(n).each(function(){var i=o(this).data(),n=i.bmBind,r=[];if(!n){var a=this.nodeName;"IMG"===a?(n="prop",r.push("src")):"INPUT"===a&&"checkbox"===this.type?(n="prop",r.push("checked")):n="INPUT"===a||"SELECT"===a||"TEXTAREA"===a?"val":"html"}o(this).data("summernote")&&(n="summernote;code"),-1!==n.indexOf(";")&&(n=n.split(";"),r.push(n[1]),n=n[0]),o.fn[n].apply(o(this),r)||(e=e||{field:i.bmField,validate:!0,message:i.bmRequiredError||i.bmField.split("$").join(" ")+" is required"},s=s.then(function(){return t.Utils.require("notification").then(function(){o.notify({message:i.bmRequiredError||i.bmField.split("$").join(" ")+" is required",icon:"fa fa-exclamation-circle"},{type:"danger",timer:5e3})})}))}),e&&(s=s.then(function(){return Promise.reject(e)})),s.then(function(){return Promise.all(o.map(i.childrens||[],function(t){return t.validate()}))})},u.prototype.wireSummernote=function(e,i){var n=this;e.data("summernote")||(n.options.summernote=n.options.summernote||{},t._.defaults(n.options.summernote,{height:"300px",focus:!1,tabsize:2,dialogsInBody:!0,callbacks:{onChange:function(t){o(this).val(t)},onImageUpload:function(i){var s=o(this).data("summernote").modules.editor,r=n.options.useMasterKey?{useMasterKey:!0}:void 0,a=Promise.resolve(),l=n.options.fileRole||!!e.data("bm-field")&&e.data("bm-field").split("$")[1]||"attachment",c=i[0];return n.model&&n.model.isNew()&&(a=a.then(function(){return a.save({},r)})),a.then(function(){var i;(n.options.fileRole||e.data("bm-field"))&&e.data("bm-field").split("$")[1];return e.parent().find(".summer-progress").show(),i={role:l,className:n.options.className,name:c.name,inline:!0,contentType:c.type||"application/octet-stream"},n.model&&n.model.id&&(i.objectId=n.model.id),t.Cloud.run("createPresignedPost",i).then(function(i){var n,a=new FormData;return t.$.each(i.fields,function(t,e){a.append(t,e)}),a.append("file",c),i.file&&(i.file.className=i.file.className||"Files",n=t.Object.fromJSON(i.file)),new Promise(function(l,d){t.$.ajax({url:i.url,type:"POST",data:a,processData:!1,contentType:!1,success:function(o){return Promise.resolve().then(function(){if(i.file)return c.size&&n.set("size",c.size),c.lastModifiedDate&&n.set("lastModified",c.lastModifiedDate),n.set("key",i.fields.key),"public-read"===i.fields.ACL&&n.set("url",i.url+"/"+i.fields.key),n.save({},r)}).then(function(i){s.restoreRange(),i&&s.insertImage(t.serverURL+"/storage/"+t.applicationId+"/"+i.id,i.get("name")),e.parent().find(".summer-progress").hide(),l()}).then(l,d)},error:function(){e.parent().find(".summer-progress").hide(),d()},xhr:function(){return myXhr=o.ajaxSettings.xhr(),myXhr.upload?myXhr.upload.addEventListener("progress",function(t){if(t.lengthComputable){var i=Math.floor(t.loaded/t.total*100);e.parent().find(".summer-progress span").html(i<95?i+"%":"sending to cloud.."),e.parent().find(".summer-progress .progress-bar").css({width:i+"%"})}},!1):(e.parent().find(".summer-progress").hide(),console.log("Uploadress is not supported.")),myXhr}})})},function(t){e.parent().find(".summer-progress").hide()})})}}}),e.summernote(n.options.summernote),e.parent().css("position","relative"),e.parent().append(n.options.progressBar))},u.prototype.update=function(){var e,n=this,s=this.options.bindFilter||"[data-bm-field]";return this.model||this.options.className?(e=this.validate(),this.model||(this.$('input[name="objectId"]').val()?this.model=new t.Object.fromJSON({className:this.options.className,objectId:this.$('input[name="objectId"]').val()}):this.model=new t.Object(this.options.className)),this.$(s).each(function(){var s,r,a=o(this).data(),l=a.bmBind,c=[];if(!(a.bmDisplayOnly||"Files"===a.fieldTarget&&"Pointer"===a.fieldType)&&(s=(s=-1===a.bmField.indexOf(";")?a.bmField:a.bmField.split(";")).split("$"))[0]===n.options.className){if(s=s[1],!l){var d=this.nodeName;if(-1!==(n.options.readOnlyBind||["P","DIV"]).indexOf(d))return;"IMG"===d?(l="prop",c.push("src")):"INPUT"===d&&"checkbox"===this.type?(l="prop",c.push("checked")):l="INPUT"===d||"SELECT"===d||"TEXTAREA"===d?"val":"html"}if(o(this).data("summernote")&&(l="summernote;code"),-1!==l.indexOf(";")&&(l=l.split(";"),c.push(l[1]),l=l[0]),r=o.fn[l].apply(o(this),c),"Number"===a.fieldType){var u=parseFloat(r);r=isNaN(u)?null:u}else"Boolean"===a.fieldType&&"string"==typeof r?r="true"===r.toLowerCase():"Pointer"===a.fieldType?r=r?t.Object.fromJSON({className:a.fieldTarget,objectId:r}):null:"String"===a.fieldType?r=r.trim():"Date"===a.fieldType?r=r&&void 0!==i&&i(r,n.options.dateFormat).isValid()?i(r,n.options.dateFormat).toDate():null:"Object"===a.fieldType&&(r=r?JSON.parse(r):null);"Relation"===a.fieldType?n.selects[s]&&(e=e.then(function(){return n.selects[s].syncRelation(n.model)})):n.model.set(s,r)}}),e.then(function(){return Promise.all(o.each(n.childrens||[],function(t){return t.update()}))})):Promise.reject(new Error("Invalid binding"))},u.prototype.destroy=function(){var e=this,i=this.childrens||[];return o.each(this.selects,function(t,e){"function"==typeof e.destroy&&i.push(e.destroy())}),o.when.apply(o,i).then(function(){return t.UI.Control.prototype.destroy.call(e)})},t.UI.Editor=u,t.UI.Editor.defaults=o.extend({},t.UI.Control.defaults,{cancelButtonClass:"footer .btn-default",createButtonClass:"footer .btn-success",removeButtonClass:"footer .btn-danger",createButtonText:'<i class="fa fa-plus"></i> Create',updateButtonText:'<i class="fa fa-floppy-o"></i> Update',imageFormat:'<li data-object-id="{id}"><div class="well well-sm"><span>{display}</span><br><strong>{name}</strong><br>{size}<br><a href="{url}" target="_blank"><i class="fa fa-download"></i> Download</a>  | <a href="#" data-file-id="{id}" class="text-danger"><i class="fa fa-times"></i> Remove</a></div></li>',progressBar:'<div class="summer-progress" style="display:none"><div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;"><span>0%</span></div></div>',bindFilter:"[data-bm-field]",dateFormat:"DD-MM-YYYY",editSyncTimer:3e4}),p.prototype=Object.create(s.prototype),p.prototype.constructor=p,p.prototype.initialize=function(){var e=this,i=this.$el.prop("id"),n={onAction:this.onAction.bind(this),onUpdated:function(){e.grid.reload(),e.trigger("saved")},onCreate:function(){var i=new t.Object(e.options.className);e.wire(i)},onCancel:function(){e.grid.show(),e.editor.hide(),e.trigger("canceled"),o("html, body").animate({scrollTop:e.grid.$el.offset().top-(e.options.scrollTopOffset||150)},200)}},s=o.extend({},n,this.options);return this.grid=this.options.grid||new c(this.$(this.options.gridId?this.options.gridId:i?"#"+i+"-table":"table.box-table"),s),this.editor=this.options.editor||new u(this.$(this.options.editorId?this.options.editorId:i?"#"+i+"-form":"form.box-editor"),s),t._.defaults(this.editor.options,n),Promise.all([this.editor.p||Promise.resolve(),this.grid.p||Promise.resolve()]).then(function(){return t.UI.Control.prototype.initialize.call(e)})},p.prototype.onAction=function(t,e,i){t.fieldId&&t.objectId&&this.wire(e)},p.prototype.wire=function(t){this.grid.hide(),this.editor.$el.removeClass("hidden").show(),this.editor.wire(t),this.trigger("wired")},p.prototype.showGrid=function(t){this.editor.hide(),this.grid.show(),t&&this.grid.reload()},p.prototype.destroy=function(){var e=this,i=[];return this.editor&&"function"==typeof this.editor.destroy&&i.push(this.editor.destroy()),this.grid&&"function"==typeof this.grid.destroy&&i.push(this.grid.destroy()),o.when.apply(o,i).then(function(){return t.UI.Control.prototype.destroy.call(e)})},t.UI.DataSet=p,t.UI.DataSet.defaults={}});